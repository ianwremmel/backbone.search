/*! backbone.search - v0.1.0-pre - 2013-06-03
* https://github.com/boazsender/backbone.search
* Copyright (c) 2013 Boaz Sender; Licensed MIT */
(function(e,t,n,r){e.Model.prototype.clearSearchScore=function(t){this.off(null,e.Model.prototype.clearSearchScore,this),this.unset("searchScore"),this.unset("searchTerm")},e.Model.prototype.getSearchScore=function(n){if(this.has("searchScore")&&(!n||this.has("searchTerm")&&this.get("searchTerm")===n))return this.get("searchScore");var r=this.searchFields?this.pick(this.searchFields):this.toJSON(),i=JSON.stringify(t.values(r)).toLowerCase(),s=i.score(n);this.set({searchScore:s,searchTerm:n});if(this.searchFields)for(var o=0;o<this.searchFields.length;o++)this.on("change:"+this.searchFields[o],e.Model.prototype.clearSearchScore,this);else this.on("change",e.Model.prototype.clearSearchScore,this);return s},e.Collection.prototype.search=function(t){t=n.trim(t.toLowerCase());var r=new e.Collection;return r.comparator=function(e){return-1*e.getSearchScore(t)},t&&this.each(function(e){e.getSearchScore(t)>0&&r.add(e,{sort:!1})}),r.sort(),r},String.prototype.score=function(e){return e.length===0?.9:e.length>this.length?0:this.indexOf(e)!==-1?e.length/this.length:0}})(Backbone,_,jQuery);